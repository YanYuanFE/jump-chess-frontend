import{c as k,j as e,a as L,b as A,u as H,r as c,d as M,e as D,B as x,s as P,D as C,f as $,g as N,__tla as __tla_0}from"./index-TbBtWJuP.js";import{I as F,T as V,a as z,b as _,c as d,d as J,e as l,__tla as __tla_1}from"./input-YS-ljkSA.js";import{u as Q,__tla as __tla_2}from"./useGameContract-Bv7bvqV8.js";let ee;let __tla=Promise.all([(()=>{try{return __tla_0}catch{}})(),(()=>{try{return __tla_1}catch{}})(),(()=>{try{return __tla_2}catch{}})()]).then(async()=>{const W=k("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const K=k("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),O=A("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function g({className:o,variant:i,...u}){return e.jsx("div",{className:L(O({variant:i}),o),...u})}function U(){const{address:o,account:i}=H(),[u,R]=c.useState([]),f=M(),{client:b,db:m}=D(),{waitForTransaction:j}=Q(),[h,S]=c.useState(""),[T,y]=c.useState(!1),[E,v]=c.useState(!1),p=async()=>{const t=new C().namespace("dojo_starter",s=>s.entity("Container",r=>r.gte("status",0))).build();try{await m?.getEntities({query:t,callback:s=>{if(s.error){console.error("resp.error.message:",s.error.message);return}if(s.data){console.log(s.data,"res");const r=s.data?.map(a=>a.models.dojo_starter?.Container).sort((a,n)=>n.game_id-a.game_id);R(r)}}})}catch(s){console.error("Error querying entities:",s)}};c.useEffect(()=>{p()},[]);const w=u?.filter(t=>t.game_id===h||t.creator.toLowerCase().includes(h.toLowerCase()))||[],q=async()=>{p(),y(!0),await $(3e3),y(!1)};c.useEffect(()=>{let t;return(async()=>{if(!o)return;const r=await m?.subscribeEntityQuery({query:new C().namespace("dojo_starter",a=>a.entity("Container",n=>(console.log(n),n.eq("creator",N(o))))).build(),callback:a=>{if(a.error)console.error("Error setting up entity sync:",a.error);else if(a.data&&a.data[0].entityId!=="0x0"){console.log("subscribed",a);const n=a.data[0].models?.dojo_starter?.Container;console.log(n,"game"),n&&f(`/game/${n?.game_id}`)}}});t=()=>r?.cancel()})(),()=>{t&&t()}},[m,o]);const G=async()=>{try{v(!0);const t=await b.actions.createGame(i);console.log(t,"tx"),await j(t?.transaction_hash)}finally{v(!1)}},I=async t=>{const s=parseInt(t?.game_id,16);if(N(t?.creator)!==o&&t?.status===0){console.log(i,"ac");const r=await b.actions.joiningGame(i,s);if(console.log(r,"tx"),!r)return;const a=await j(r?.transaction_hash);console.log(a)}f(`/game/${t?.game_id}`)},B=t=>{switch(t){case 0:return e.jsx(g,{variant:"secondary",children:"Waiting"});case 1:return e.jsx(g,{variant:"default",children:"In Progress"});case 2:return e.jsx(g,{variant:"outline",children:"Finished"})}};return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"relative flex justify-between py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Game Room List"}),e.jsx(x,{onClick:G,loading:E,children:"Create Game"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(F,{type:"text",placeholder:"Search by room number or creator",value:h,onChange:t=>S(t.target.value),className:"pl-10"}),e.jsx(K,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),e.jsxs(x,{onClick:q,variant:"outline",size:"icon",children:[e.jsx(W,{className:L("h-4 w-4",T?"animate-spin":"")}),e.jsx("span",{className:"sr-only",children:"Refresh list"})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(V,{children:[e.jsx(z,{children:e.jsxs(_,{children:[e.jsx(d,{children:"Room Number"}),e.jsx(d,{children:"Created By"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Players"}),e.jsx(d,{children:"Action"})]})}),e.jsx(J,{children:w.map(t=>e.jsxs(_,{children:[e.jsx(l,{className:"font-medium",children:t.game_id}),e.jsx(l,{children:P(t.creator)}),e.jsx(l,{children:B(t.status)}),e.jsx(l,{children:`${t.status===0?1:2}/2`}),e.jsx(l,{children:e.jsx(x,{onClick:()=>I(t),disabled:t.status!==0,children:"Join"})})]},t.game_id))})]})}),w.length===0&&e.jsx("p",{className:"text-center text-muted-foreground mt-4",children:"No matching rooms found"})]})}ee=function(){return e.jsx("main",{className:"container p-6",children:e.jsx(U,{})})}});export{ee as default,__tla};