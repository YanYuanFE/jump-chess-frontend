import{c as L,j as e,a as R,b as H,u as M,r as c,d as $,e as D,B as u,s as C,D as N,f as P,g as _,__tla as __tla_0}from"./index-DFsdLsM1.js";import{I as V,T as F,a as W,b as k,c as o,d as z,e as d,__tla as __tla_1}from"./input-CAQwrwbk.js";import{u as J,__tla as __tla_2}from"./useGameContract-68INYc6U.js";let ee;let __tla=Promise.all([(()=>{try{return __tla_0}catch{}})(),(()=>{try{return __tla_1}catch{}})(),(()=>{try{return __tla_2}catch{}})()]).then(async()=>{const Q=L("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const K=L("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),O=H("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function f({className:i,variant:l,...m}){return e.jsx("div",{className:R(O({variant:l}),i),...m})}function U(){const{address:i,account:l}=M(),[m,S]=c.useState([]),h=$(),{client:j,db:x}=D(),{waitForTransaction:b}=J(),[g,T]=c.useState(""),[E,y]=c.useState(!1),[q,v]=c.useState(!1),p=async()=>{const a=new N().namespace("dojo_starter",s=>s.entity("Container",r=>r.gte("status",0))).build();try{await x?.getEntities({query:a,callback:s=>{if(s.error){console.error("resp.error.message:",s.error.message);return}if(s.data){console.log(s.data,"res");const r=s.data?.map(t=>t.models.dojo_starter?.Container).sort((t,n)=>n.game_id-t.game_id);S(r)}}})}catch(s){console.error("Error querying entities:",s)}};c.useEffect(()=>{p()},[]);const w=m?.filter(a=>a.game_id===g||a.creator.toLowerCase().includes(g.toLowerCase()))||[],G=async()=>{p(),y(!0),await P(3e3),y(!1)};c.useEffect(()=>{let a;return(async()=>{if(!i)return;const r=await x?.subscribeEntityQuery({query:new N().namespace("dojo_starter",t=>t.entity("Container",n=>(console.log(n),n.eq("creator",_(i))))).build(),callback:t=>{if(t.error)console.error("Error setting up entity sync:",t.error);else if(t.data&&t.data[0].entityId!=="0x0"){console.log("subscribed",t);const n=t.data[0].models?.dojo_starter?.Container;console.log(n,"game"),n&&h(`/game/${n?.game_id}`)}}});a=()=>r?.cancel()})(),()=>{a&&a()}},[x,i]);const B=async()=>{try{v(!0);const a=await j.actions.createGame(l);console.log(a,"tx"),await b(a?.transaction_hash)}finally{v(!1)}},I=async a=>{const s=a?.game_id;if(_(a?.creator)!==i&&a?.status===0){console.log(l,"ac");const r=await j.actions.joiningGame(l,s);if(console.log(r,"tx"),!r)return;const t=await b(r?.transaction_hash);console.log(t)}h(`/game/${a?.game_id}`)},A=a=>{switch(a){case 0:return e.jsx(f,{variant:"secondary",children:"Waiting"});case 1:return e.jsx(f,{variant:"default",children:"In Progress"});case 2:return e.jsx(f,{variant:"outline",children:"Finished"})}};return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"relative flex justify-between py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Game Room List"}),e.jsx(u,{onClick:B,loading:q,children:"Create Game"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(V,{type:"text",placeholder:"Search by room number or creator",value:g,onChange:a=>T(a.target.value),className:"pl-10"}),e.jsx(K,{className:"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground"})]}),e.jsxs(u,{onClick:G,variant:"outline",size:"icon",children:[e.jsx(Q,{className:R("h-4 w-4",E?"animate-spin":"")}),e.jsx("span",{className:"sr-only",children:"Refresh list"})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(F,{children:[e.jsx(W,{children:e.jsxs(k,{children:[e.jsx(o,{children:"Room Number"}),e.jsx(o,{children:"Created By"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Players"}),e.jsx(o,{children:"Winner"}),e.jsx(o,{children:"Action"})]})}),e.jsx(z,{children:w.map(a=>e.jsxs(k,{children:[e.jsx(d,{className:"font-medium",children:a.game_id}),e.jsx(d,{children:C(a.creator)}),e.jsx(d,{children:A(a.status)}),e.jsx(d,{children:`${a.status===0?1:2}/2`}),e.jsx(d,{children:a.status===2?C(a.winner):"-"}),e.jsxs(d,{className:"flex gap-2 items-end",children:[e.jsx(u,{onClick:()=>I(a),disabled:a.status!==0,children:"Join"}),e.jsx(u,{onClick:()=>h(`/game/${a.game_id}`),children:"Visit"})]})]},a.game_id))})]})}),w.length===0&&e.jsx("p",{className:"text-center text-muted-foreground mt-4",children:"No matching rooms found"})]})}ee=function(){return e.jsx("main",{className:"container p-6",children:e.jsx(U,{})})}});export{ee as default,__tla};